---
admin:
  existingSecret: grafana-admin-secret
  userKey: admin-user
  passwordKey: SECRET_GRAFANA_PASSWORD

replicas: 1

deployment:
  strategy:
    type: Recreate

terminationGracePeriodSeconds: 60

readinessProbe:
  httpGet:
    path: /api/health
    port: 3000
  initialDelaySeconds: 10
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3

livenessProbe:
  httpGet:
    path: /api/health
    port: 3000
  initialDelaySeconds: 30
  periodSeconds: 30
  timeoutSeconds: 10
  failureThreshold: 3

persistence:
  enabled: true
  type: pvc
  storageClassName: ceph-block
  size: 10Gi

ingress:
  enabled: false

serviceMonitor:
  enabled: true

resources:
  requests:
    cpu: 100m
    memory: 256Mi
  limits:
    memory: 512Mi

grafana.ini:
  server:
    root_url: https://grafana.${SECRET_DOMAIN}
  analytics:
    check_for_updates: false
    check_for_plugin_updates: false
    reporting_enabled: false
  security:
    cookie_secure: true
    cookie_samesite: strict
    strict_transport_security: true
  auth:
    disable_login_form: false
  auth.anonymous:
    enabled: false
  log:
    mode: console
  paths:
    data: /var/lib/grafana/
    logs: /var/log/grafana
    plugins: /var/lib/grafana/plugins
    provisioning: /etc/grafana/provisioning

datasources:
  datasources.yaml:
    apiVersion: 1
    datasources:
      - name: Prometheus
        type: prometheus
        uid: prometheus
        url: http://kube-prometheus-stack-prometheus.observability.svc.cluster.local:9090
        access: proxy
        isDefault: true
        jsonData:
          httpMethod: POST
          timeInterval: 30s

      - name: VictoriaLogs
        type: victoriametrics-logs-datasource
        access: proxy
        url: http://victoria-logs-server.observability.svc.cluster.local:9428

      - name: Alertmanager
        type: alertmanager
        access: proxy
        url: http://alertmanager-operated.observability.svc.cluster.local:9093
        jsonData:
          implementation: prometheus

dashboardProviders:
  dashboardproviders.yaml:
    apiVersion: 1
    providers:
      - name: default
        orgId: 1
        folder: ""
        type: file
        disableDeletion: false
        editable: true
        options:
          path: /var/lib/grafana/dashboards/default

      - name: flux
        orgId: 1
        folder: Flux
        type: file
        disableDeletion: false
        editable: true
        options:
          path: /var/lib/grafana/dashboards/flux

      - name: kubernetes
        orgId: 1
        folder: Kubernetes
        type: file
        disableDeletion: false
        editable: true
        options:
          path: /var/lib/grafana/dashboards/kubernetes

      - name: storage
        orgId: 1
        folder: Storage
        type: file
        disableDeletion: false
        editable: true
        options:
          path: /var/lib/grafana/dashboards/storage

      - name: ceph
        orgId: 1
        folder: Ceph
        type: file
        disableDeletion: false
        editable: true
        options:
          path: /var/lib/grafana/dashboards/ceph

dashboards:
  default:
    blackbox-exporter:
      datasource: Prometheus
      url: https://grafana.com/api/dashboards/7587/revisions/3/download
    cert-manager:
      datasource: Prometheus
      url: https://grafana.com/api/dashboards/20842/revisions/3/download
    cloudflared:
      datasource:
        - name: DS_PROMETHEUS
          value: Prometheus
      url: https://grafana.com/api/dashboards/17457/revisions/6/download
    # envoy:
    #   datasource:
    #     - name: DS_AFRANET_PROMETHEUS
    #       value: Prometheus
    #   url: https://grafana.com/api/dashboards/23239/revisions/1/download
    node-exporter-full:
      datasource:
        - name: DS_PROMETHEUS
          value: Prometheus
      url: https://grafana.com/api/dashboards/1860/revisions/42/download
    prometheus:
      datasource: Prometheus
      url: https://grafana.com/api/dashboards/19105/revisions/8/download
    smartctl-exporter:
      datasource:
        - name: DS_PROMETHEUS
          value: Prometheus
      url: https://grafana.com/api/dashboards/22604/revisions/2/download

    volsync:
      datasource:
        - name: DS_PROMETHEUS
          value: Prometheus
        - name: VAR_REPLICATIONDESTNAME
          value: ".*-bootstrap"
      url: https://grafana.com/api/dashboards/21356/revisions/3/download

  flux:
    flux-cluster:
      url: https://raw.githubusercontent.com/fluxcd/flux2-monitoring-example/main/monitoring/configs/dashboards/cluster.json
      datasource: Prometheus
    flux-control-plane:
      url: https://raw.githubusercontent.com/fluxcd/flux2-monitoring-example/main/monitoring/configs/dashboards/control-plane.json
      datasource: Prometheus

  ceph:
    ceph-cluster:
      datasource: Prometheus
      url: https://grafana.com/api/dashboards/2842/revisions/18/download
    ceph-osd:
      datasource: Prometheus
      url: https://grafana.com/api/dashboards/5336/revisions/9/download
    ceph-pools:
      datasource: Prometheus
      url: https://grafana.com/api/dashboards/5342/revisions/9/download

  kubernetes:
    kubernetes-api-server:
      datasource: Prometheus
      url: https://grafana.com/api/dashboards/15761/revisions/20/download
    kubernetes-coredns:
      datasource: Prometheus
      url: https://grafana.com/api/dashboards/15762/revisions/22/download
    kubernetes-global:
      datasource: Prometheus
      url: https://grafana.com/api/dashboards/15757/revisions/43/download
    kubernetes-namespaces:
      datasource: Prometheus
      url: https://grafana.com/api/dashboards/15758/revisions/44/download
    kubernetes-nodes:
      datasource: Prometheus
      url: https://grafana.com/api/dashboards/15759/revisions/40/download
    kubernetes-pods:
      datasource: Prometheus
      url: https://grafana.com/api/dashboards/15760/revisions/37/download
    kubernetes-volumes:
      datasource: Prometheus
      url: https://grafana.com/api/dashboards/11454/revisions/14/download

sidecar:
  dashboards:
    enabled: true
    searchNamespace: ALL
    folderAnnotation: grafana_folder
    provider:
      foldersFromFilesStructure: true
  datasources:
    enabled: true
    searchNamespace: ALL

plugins:
  - grafana-clock-panel
  - grafana-piechart-panel
  - grafana-worldmap-panel
  - ae3e-plotly-panel
  - vonage-status-panel
  - victoriametrics-logs-datasource
