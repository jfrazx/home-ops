---
replicaCount: 1

persistence:
  enabled: true
  storageClass: ceph-block
  size: 10Gi

resources:
  requests:
    cpu: 10m
    memory: 50Mi
  limits:
    memory: 200Mi

serviceMonitor:
  enabled: true

extraSecrets:
  - name: alertmanager-webhook-secret
    mountPath: /etc/secrets/webhook
    readOnly: true

podSecurityContext:
  runAsUser: 65534
  runAsGroup: 65534
  fsGroup: 65534

securityContext:
  allowPrivilegeEscalation: false
  readOnlyRootFilesystem: true
  runAsNonRoot: true
  runAsUser: 65534
  capabilities:
    drop:
      - ALL

config:
  global:
    resolve_timeout: 5m
  route:
    group_by: ["alertname", "cluster", "service"]
    group_wait: 10s
    group_interval: 5m
    repeat_interval: 6h
    receiver: "webhook-alerts"
    routes:
      - receiver: "null"
        matchers:
          - alertname =~ "InfoInhibitor|Watchdog"
      - receiver: "null"
        matchers:
          - severity = "none"
      - receiver: "webhook-alerts"
        continue: true
  receivers:
    - name: "null"
    - name: "webhook-alerts"
      webhook_configs:
        - url_file: '/etc/secrets/webhook/webhook-url'
          send_resolved: true
          http_config:
            follow_redirects: true
          title: 'Alert: {{ .GroupLabels.alertname }}'
          text: '{{ range .Alerts }}{{ .Annotations.summary }}{{ end }}'
  inhibit_rules:
    - source_matchers:
        - severity = "critical"
      target_matchers:
        - severity = "warning"
      equal: ["alertname", "cluster", "service"]
