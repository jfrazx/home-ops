---
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: searxng-secret
  namespace: ai
spec:
  refreshInterval: 5m
  secretStoreRef:
    kind: ClusterSecretStore
    name: openbao-cluster-secretstore
  target:
    name: searxng-secret
    creationPolicy: Owner
    deletionPolicy: Delete
    template:
      engineVersion: v2
      data:
        SEARXNG_SECRET: "{{ .secret_key }}"
        SEARXNG_REDIS_URL: "redis://dragonflydb.database.svc.cluster.local:6379/7?password={{ .redis_password | urlquery }}"

  data:
    - secretKey: secret_key
      remoteRef:
        key: ai/searxng/credentials
        property: secret_key
    - secretKey: redis_password
      remoteRef:
        key: database/dragonflydb/credentials
        property: password
